

<header class="jumbotron subhead bodyPadding" id="overview">
  <div class="container">
    <h1>Share photo timeframe</h1>
    <p class="lead">Instead of sharing photos one by one, you will share a timeframe in your life</p>
  </div>
</header>

<div class="container">

  <div ng-controller="ShareController" class="row {{toggle}}">
    <form method="post" action="?" class="span3 well">
      <h2>Share timeframe</h2>

      <label>Name of this timeframe</label>
      <input type="text" autocomplete="off" required="required" id="name" name="name" ng-model="name"><br>

      <label>Email to share to</label>
      <input type="text" autocomplete="off" required="required" id="email" name="email" ng-change="refreshPhotos()" ng-model="email"><br>
      <label>Dates to share</label>
      <input type="hidden" ng-model="fromDate" ng-init="fromDate = '<%=fromDate%>'">
      <input type="hidden" ng-model="toDate" ng-init="toDate = '<%=toDate%>'">

      <input type="text" name="daterange" ng-model="dateRange" placeholder="Enter date" ng-init="defaultDateRange = '<%=fromDate.split('T')[0] + " - " + toDate.split('T')[0] + ' 23:59:59' %>'">
      <input type="submit" class="btn btn-success pull-right" value="Share">
      <small>{{photos.length}} photos selected (<a ng-click="reset()" href="#">reset</a>)</small>
      
    </form>
    <div class="span8">
      <ul class="thumbnails preview pull-right">
        <li ng-repeat="photo in photos" class="thumbnail span1">
          <img ng-src="{{photo.src}}" ng-click="select(photo)">
        </li>
      </ul>
    
    </div>

  </div>
</div>

<script type="text/javascript" src="/controllers/share.js"></script>
<script type="text/javascript" src="/js/bootstrap-daterangepicker/date.js"></script>
<script type="text/javascript" src="/js/bootstrap-daterangepicker/daterangepicker.js"></script>
<link rel="stylesheet" type="text/css" href="/js/bootstrap-daterangepicker/daterangepicker.css" />

<script type="text/javascript">
  $(document).ready(function() {

    
      document.querySelector( '.thumbnails' ).addEventListener( 'dblclick', function( event ) {
        if (event.target.tagName == "IMG") {
          zoom.to({ element: event.target });
        }
      } );



    $('input[name="daterange"]').daterangepicker(
      {
          ranges: {
              'Today': ['today', 'today'],
              'Yesterday': ['yesterday', 'yesterday'],
              'Last 7 Days': [Date.today().add({ days: -6 }), 'today'],
              'Last 30 Days': [Date.today().add({ days: -29 }), 'today'],
              'This Month': [Date.today().moveToFirstDayOfMonth(), Date.today().moveToLastDayOfMonth()],
              'Last Month': [Date.today().moveToFirstDayOfMonth().add({ months: -1 }), Date.today().moveToFirstDayOfMonth().add({ days: -1 })]
          }
      }, 
      function(start, end) {
          $('#reportrange span').html(start.toString('yyyy-dd-MM') + ' - ' + end.toString('yyyy-dd-MM 23:59:59'));
          $('#reportrange span').onChange();
      }
    );

    $('input#email').typeahead({
      source: function (query, process) {
          $.get('/users', { query: query }, function (data) {
            var emails = [];
            if (data){
              emails = JSON.parse(data)
              emails = emails.map(function(item){
                var email = item.emails ? item.emails[0] : null;

                // only allow non duplicates
                if (email && !emails.some(function(existing){ return existing == email})) {
                  return email;
                } else {
                  return null;
                }

              });
              console.log(emails);
              process(emails);
            }
          });
      }

  });
});

</script>